# path: ~/.config/yazi/keymap.toml
# description: Delta-only keymap — inherits ALL Yazi defaults, overrides only what's intentional.
#              Same IoC philosophy as yabairc: neutral base (Yazi defaults) + surgical profile (this file).
#
# architecture: prepend = overrides (shadows defaults, higher priority)
#               append  = additions (new bindings defaults don't have)
#
# defaults you get FOR FREE by not redeclaring them:
#   navigation:   hjkl, gg/G, <C-u/d/b/f>, H/L (back/forward), arrows
#   operations:   y (yank), x (cut), p/P (paste), d/D (remove), a (create), r (rename)
#   search:       s/S (fd/rg), <C-s> (cancel), f (filter), / (find), ?/n/N
#   sort:         ,a/,A (alpha), ,n/,N (natural), ,e/,E (ext), ,b/,B (btime)
#                 ,m/,M (mtime + auto linemode), ,s/,S (size + auto linemode), ,r (random)
#   linemode:     m,s/m,p/m,b/m,m/m,o/m,n (size/perms/btime/mtime/owner/none)
#   copy:         c,c (path), c,d (dirname), c,f (filename), c,n (stem)
#   goto:         g,h (home), g,c (config), g,d (downloads), g,<Space> (interactive), g,f (follow)
#   tabs:         t (create), 1-9 (switch), [/] (prev/next), {/} (swap)
#   visual:       v/V, <Space> (toggle+advance), <C-a> (select all), <C-r> (invert)
#   preview:      K/J (seek up/down)
#   spot:         <Tab> (spotter — file info popup)
#   jump:         z (fzf), Z (zoxide)
#   task mgr:     w (tasks:show)
#   help:         ~/F1
#   misc:         . (hidden toggle), ;/: (shell), <C-z> (suspend), gx-style open
#
# input layer:    FULL vi-mode (h/l/w/b/e/0/$, d/c/s/x/y/p, u/U/<C-r>, i/I/a/A/v/V/r)
# all sub-layers: [tasks], [spot], [pick], [input], [confirm], [cmp], [help] — complete defaults
#
# version: yazi v26.1.22 | macOS Tahoe (M4 Max) | HHKB Type-S
# date: 2026-02-09
# CHANGELOG: 2026-02-09 | Ground-up rewrite: delta-only architecture | ROLLBACK: Restore full keymap.toml from git

"$schema" = "https://yazi-rs.github.io/schemas/keymap.json"

# ═══════════════════════════════════════════════════════════════════
# [mgr] — file list pane
# ═══════════════════════════════════════════════════════════════════

[mgr]

# ── OVERRIDES (shadow defaults) ──────────────────────────────────
prepend_keymap = [

  # ── Quit swap ──────────────────────────────────────────────────
  # WHY: cd-on-quit is the common exit (Q). Plain quit (q) is the safe/fast bail.
  # Default: q=quit, Q=quit --no-cwd-file. We swap them.
  { on = "q", run = "quit --no-cwd-file", desc = "Quit (no cd)" },
  { on = "Q", run = "quit",               desc = "Quit + cd to CWD" },

  # ── Escape: nuclear cancel ─────────────────────────────────────
  # WHY: Default escape only cancels the most recent mode. --all clears everything:
  # visual, selection, filter, search, find — one key resets all state.
  { on = "<Esc>", run = "escape --all", desc = "Escape (clear all)" },
  { on = "<C-[>", run = "escape --all", desc = "Escape (clear all)" },
  { on = "<C-c>", run = "escape --all", desc = "Escape (clear all)" },

  # ── Navigation: no wraparound ──────────────────────────────────
  # WHY: arrow -1/1 stops at boundaries. Default prev/next wraps around.
  # Personal preference: wrapping is disorienting in large directories.
  { on = "k", run = "arrow -1", desc = "Up (no wrap)" },
  { on = "j", run = "arrow 1",  desc = "Down (no wrap)" },

  # ── Selection: no auto-advance ─────────────────────────────────
  # WHY: Default toggles AND moves cursor down. This toggles only.
  # Lets you inspect what you selected before moving. More vim-like.
  { on = "<Space>", run = "toggle", desc = "Toggle select (no advance)" },

  # ── Open: hovered only ─────────────────────────────────────────
  # WHY: Default `open` acts on selection if present, which can accidentally
  # open 50 files. --hovered ensures Enter always opens just the one under cursor.
  { on = "<Enter>", run = "open --hovered", desc = "Open hovered file" },

  # ── Disable single-key `o` (claimed as prefix) ────────────────
  # WHY: Default o=open. We use `o` as prefix for open/with namespace.
  # <Enter> already handles opening. This frees o,* for multi-key sequences.
  { on = "o", run = "noop", desc = "Reserved: open/* prefix" },

  # ── Links: force by default ────────────────────────────────────
  # WHY: Default link/hardlink fails if target exists. --force overwrites.
  # You're making a symlink on purpose — you want it to work.
  { on = "-",     run = "link --force",              desc = "Symlink (absolute, force)" },
  { on = "_",     run = "link --relative --force",   desc = "Symlink (relative, force)" },
  { on = "<C-->", run = "hardlink --force",          desc = "Hardlink (force)" },

  # ── Clipboard: copy file contents ──────────────────────────────
  # WHY: Default Y=unyank. We override to copy file contents to clipboard.
  # unyank remains on X (default). One key = copy content, not path.
  { on = "Y", run = ["shell -- cat \"$@\" | pbcopy", "noop"], desc = "Copy file contents to clipboard" },

  # ── Sort overrides (no auto-linemode) ──────────────────────────
  # WHY: Default ,m/,M/,s/,S auto-switch linemode. We want sort-only.
  # Linemode is a separate concern — change it explicitly via m,* or g,* prefix.
  { on = [",", "m"], run = "sort mtime",            desc = "Sort: mtime" },
  { on = [",", "M"], run = "sort mtime --reverse",  desc = "Sort: mtime (rev)" },
  { on = [",", "s"], run = "sort size",             desc = "Sort: size" },
  { on = [",", "S"], run = "sort size --reverse",   desc = "Sort: size (rev)" },
  { on = [",", "b"], run = "sort btime",            desc = "Sort: btime" },
  { on = [",", "B"], run = "sort btime --reverse",  desc = "Sort: btime (rev)" },
]

# ── ADDITIONS (new bindings) ─────────────────────────────────────
append_keymap = [

  # ── open/with namespace ────────────────────────────────────────
  { on = ["o", "w", "p"], run = "open --interactive",desc = "open/with/picker" },
  { on = ["o", "w", "c"], run = 'shell --orphan -- sh -lc "command -v code >/dev/null 2>&1 && code -- \"$@\" || open -a \"Visual Studio Code\" \"$@\" "', desc = "open/with/vscode" },
  { on = ["o", "w", "m"], run = 'shell --orphan -- open -a "Modern CSV" "$@"', desc = "edit/with/modern-csv" },
  { on = ["o", "w", "f"], run = 'shell --orphan -- open -R "$@"', desc = "open/with/finder (reveal)" },
  { on = ["o", "t", "t"], run = """shell --orphan -- sh -lc 'tmux new-window -c "$PWD"'""", desc = "open/tmux/tab" },

  # ── goto/to bookmarks ─────────────────────────────────────────
  # WHY: Frecency (zoxide) handles most navigation. These are for fixed directories
  # you always want at exactly 3 keystrokes. g,c (2 keys) also reaches config — this is for consistency.
  { on = ["g", "t", "r"], run = "cd ~/.repository", desc = "goto/to/repository" },
  { on = ["g", "t", "w"], run = "cd ~/.westernu",   desc = "goto/to/westernu" },
  { on = ["g", "t", "c"], run = "cd ~/.config",     desc = "goto/to/config" },
  { on = ["g", "t", "d"], run = "cd ~/Downloads",     desc = "goto/to/downloads" },

  # ── macOS integrations ─────────────────────────────────────────
  # { on = "R", run = 'shell --orphan -- open -R "$@"', desc = "Reveal selected in Finder" },
  # { on = "F", run = 'shell --orphan -- open .',        desc = "Open CWD in Finder" },

  # ── Shell here ─────────────────────────────────────────────────
  # WHY: Vim convention (:! = shell). Drop into $SHELL at CWD without leaving yazi.
  { on = "!", run = 'shell "$SHELL" --block', desc = "Open $SHELL here" },
]

# ═══════════════════════════════════════════════════════════════════
# [input] — rename/create/cd text input
# ═══════════════════════════════════════════════════════════════════
# INHERITS: Full vi-mode (h/l/w/b/e/0/$, i/I/a/A, d/c/s/x/y/p, u/U/<C-r>, v/V/r)
# Only override what you actually want different from defaults.

[input]

prepend_keymap = [
  # WHY: Override <C-b>/<C-f> from char movement (default) to WORD movement.
  # Emacs convention: C-b/C-f = backward/forward word in readline.
  # Default h/l still handles char movement in normal mode.
  { on = "<C-b>", run = "backward",              desc = "Back one word" },
  { on = "<C-f>", run = "forward --end-of-word", desc = "Forward to end of word" },
]

# ═══════════════════════════════════════════════════════════════════
# All other layers inherit complete defaults:
#   [tasks]   — close, navigate, inspect, cancel, help
#   [spot]    — close, navigate, swipe, copy cell, help
#   [pick]    — close, submit, navigate, help
#   [confirm] — close, submit, y/n, navigate, help
#   [cmp]     — close, submit, navigate (<A-j/k>, <C-p/n>), help
#   [help]    — escape, navigate, filter
# ═══════════════════════════════════════════════════════════════════
